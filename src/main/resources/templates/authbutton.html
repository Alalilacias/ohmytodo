<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<body>
<div th:fragment="auth-button">
    <button class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#loginModal"
            sec:authorize="!isAuthenticated()">
        <i class="bi bi-person-circle me-1"></i> <span th:text="#{auth.login_register}">Login/Register</span>
    </button>

    <form th:action="@{/api/auth/logout}" method="post" sec:authorize="isAuthenticated()"
          id="logoutForm" style="display:inline;">
        <button type="submit" class="btn btn-outline-light">
            <i class="bi bi-box-arrow-right me-1"></i> <span th:text="#{auth.logout}">Logout</span>
        </button>
    </form>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const logoutForm = document.getElementById("logoutForm");
            if (logoutForm) {
                logoutForm.addEventListener("submit", async function (e) {
                    e.preventDefault();

                    const res = await fetch('/api/auth/logout', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    });

                    const msg = document.createElement('div');
                    msg.classList.add('alert', 'mt-3', 'fade', 'show');
                    msg.setAttribute('role', 'alert');

                    if (res.ok) {
                        msg.classList.add('alert-success');
                        msg.innerText = 'Logout successful!';
                        document.body.prepend(msg);
                        setTimeout(() => location.reload(), 1000);
                    } else {
                        msg.classList.add('alert-danger');
                        msg.innerText = 'Logout failed.';
                        document.body.prepend(msg);
                    }
                });
            }
        });
    </script>

    <div th:replace="~{loginmodal :: login-modal}" sec:authorize="!isAuthenticated()"></div>
    <div th:replace="~{registermodal :: register-modal}" sec:authorize="!isAuthenticated()"></div>
</div>
</body>
</html>
